# Linear model

``` python
import pandas as pd
import statsmodels.formula.api as smf
import statsmodels.api as sm
import polars as pl
from marginaleffects import comparisons, predictions

# load data and fit model
df = sm.datasets.get_rdataset("Guerry", "HistData").data
mod = smf.ols("Literacy ~ Pop1831 * Desertion", df)
fit = mod.fit()
```

# `comparisons()`

## Difference

``` python
comparisons(fit, variables = "Pop1831", value = 1, comparison = "differenceavg")
```

<small>shape: (1, 5)</small>

| estimate | std_error | statistic | conf_low  | conf_high |
|----------|-----------|-----------|-----------|-----------|
| f64      | f64       | f64       | f64       | f64       |
| 0.003717 | 0.011597  | 0.320485  | -0.019353 | 0.026786  |


``` python
comparisons(fit, variables = "Pop1831", value = 1, comparison = "difference").head()
```

<small>shape: (5, 28)</small>

| estimate  | std_error | statistic | conf_low  | conf_high | dept | Region | Department     | Crime_pers | Crime_prop | Literacy | Donations | Infants | Suicides | MainCity | Wealth | Commerce | Clergy | Crime_parents | Infanticide | Donation_clergy | Lottery | Desertion | Instruction | Prostitutes | Distance | Area | Pop1831 |
|-----------|-----------|-----------|-----------|-----------|------|--------|----------------|------------|------------|----------|-----------|---------|----------|----------|--------|----------|--------|---------------|-------------|-----------------|---------|-----------|-------------|-------------|----------|------|---------|
| f64       | f64       | f64       | f64       | f64       | i64  | str    | str            | i64        | i64        | i64      | i64       | i64     | i64      | str      | i64    | i64      | i64    | i64           | i64         | i64             | i64     | i64       | i64         | i64         | f64      | i64  | f64     |
| -0.009946 | 0.013663  | -0.727936 | -0.037126 | 0.017234  | 1    | "E"    | "Ain"          | 28870      | 15890      | 37       | 5098      | 33120   | 35039    | "2:Med"  | 73     | 58       | 11     | 71            | 60          | 69              | 41      | 55        | 46          | 13          | 218.372  | 5762 | 346.03  |
| -0.042023 | 0.025143  | -1.671333 | -0.092041 | 0.007995  | 2    | "N"    | "Aisne"        | 26226      | 5521       | 51       | 8901      | 14572   | 12831    | "2:Med"  | 22     | 10       | 82     | 4             | 82          | 36              | 38      | 82        | 24          | 327         | 65.945   | 7369 | 513.0   |
| 0.036388  | 0.018517  | 1.965047  | -0.000449 | 0.073225  | 3    | "C"    | "Allier"       | 26747      | 7925       | 13       | 10973     | 17044   | 114121   | "2:Med"  | 61     | 66       | 68     | 46            | 42          | 76              | 66      | 16        | 85          | 34          | 161.927  | 7340 | 298.26  |
| 0.017379  | 0.012825  | 1.355129  | -0.008133 | 0.042891  | 4    | "E"    | "Basses-Alpes" | 12935      | 7289       | 46       | 2733      | 23018   | 14238    | "1:Sm"   | 76     | 49       | 5      | 70            | 12          | 37              | 80      | 32        | 29          | 2           | 351.399  | 6925 | 155.9   |
| 0.013815  | 0.012195  | 1.132804  | -0.010445 | 0.038075  | 5    | "E"    | "Hautes-Alpes" | 17488      | 8174       | 69       | 6962      | 23076   | 16171    | "1:Sm"   | 83     | 65       | 10     | 22            | 23          | 64              | 79      | 35        | 7           | 1           | 320.28   | 5549 | 129.1   |


## Ratio

``` python
comparisons(fit, variables = "Pop1831", value = 1, comparison = "ratioavg")
```

<small>shape: (1, 5)</small>

| estimate | std_error | statistic   | conf_low | conf_high |
|----------|-----------|-------------|----------|-----------|
| f64      | f64       | f64         | f64      | f64       |
| 1.000255 | 0.00033   | 3029.838358 | 0.999598 | 1.000911  |


``` python
comparisons(fit, variables = "Pop1831", value = 1, comparison = "ratio").head()
```

<small>shape: (5, 28)</small>

| estimate | std_error | statistic   | conf_low | conf_high | dept | Region | Department     | Crime_pers | Crime_prop | Literacy | Donations | Infants | Suicides | MainCity | Wealth | Commerce | Clergy | Crime_parents | Infanticide | Donation_clergy | Lottery | Desertion | Instruction | Prostitutes | Distance | Area | Pop1831 |
|----------|-----------|-------------|----------|-----------|------|--------|----------------|------------|------------|----------|-----------|---------|----------|----------|--------|----------|--------|---------------|-------------|-----------------|---------|-----------|-------------|-------------|----------|------|---------|
| f64      | f64       | f64         | f64      | f64       | i64  | str    | str            | i64        | i64        | i64      | i64       | i64     | i64      | str      | i64    | i64      | i64    | i64           | i64         | i64             | i64     | i64       | i64         | i64         | f64      | i64  | f64     |
| 0.999769 | 0.000315  | 3176.733532 | 0.999143 | 1.000395  | 1    | "E"    | "Ain"          | 28870      | 15890      | 37       | 5098      | 33120   | 35039    | "2:Med"  | 73     | 58       | 11     | 71            | 60          | 69              | 41      | 55        | 46          | 13          | 218.372  | 5762 | 346.03  |
| 0.999044 | 0.000647  | 1544.357883 | 0.997758 | 1.000331  | 2    | "N"    | "Aisne"        | 26226      | 5521       | 51       | 8901      | 14572   | 12831    | "2:Med"  | 22     | 10       | 82     | 4             | 82          | 36              | 38      | 82        | 24          | 327         | 65.945   | 7369 | 513.0   |
| 1.001225 | 0.000675  | 1484.291758 | 0.999883 | 1.002567  | 3    | "C"    | "Allier"       | 26747      | 7925       | 13       | 10973     | 17044   | 114121   | "2:Med"  | 61     | 66       | 68     | 46            | 42          | 76              | 66      | 16        | 85          | 34          | 161.927  | 7340 | 298.26  |
| 1.000529 | 0.000434  | 2306.440576 | 0.999666 | 1.001391  | 4    | "E"    | "Basses-Alpes" | 12935      | 7289       | 46       | 2733      | 23018   | 14238    | "1:Sm"   | 76     | 49       | 5      | 70            | 12          | 37              | 80      | 32        | 29          | 2           | 351.399  | 6925 | 155.9   |
| 1.000405 | 0.000393  | 2545.67391  | 0.999624 | 1.001187  | 5    | "E"    | "Hautes-Alpes" | 17488      | 8174       | 69       | 6962      | 23076   | 16171    | "1:Sm"   | 83     | 65       | 10     | 22            | 23          | 64              | 79      | 35        | 7           | 1           | 320.28   | 5549 | 129.1   |


## Group averages (SEs are broken)

``` python
comparisons(fit, variables = "Pop1831", value = 1, comparison = "difference", by = "Region")
```

<small>shape: (6, 6)</small>

| Region | estimate  | std_error     | statistic  | conf_low       | conf_high     |
|--------|-----------|---------------|------------|----------------|---------------|
| str    | f64       | f64           | f64        | f64            | f64           |
| "W"    | -0.006382 | 2.7299e6      | -2.3377e-9 | -5.4306e6      | 5.4306e6      |
| "C"    | 0.017379  | 2.2592e6      | 7.6926e-9  | -4.4942e6      | 4.4942e6      |
| "S"    | 0.021782  | 4.1896e6      | 5.1990e-9  | -8.3344e6      | 8.3344e6      |
| null   | 0.044704  | 487710.968808 | 9.1661e-8  | -970212.435968 | 970212.525375 |
| "N"    | -0.004984 | 4.1391e6      | -1.2041e-9 | -8.2339e6      | 8.2339e6      |
| "E"    | -0.011623 | 39564.548326  | -2.9377e-7 | -78706.501805  | 78706.478559  |


# `predictions()`

``` python
predictions(fit).head()
```

<small>shape: (5, 28)</small>

| estimate  | std_error | statistic | conf_low  | conf_high | dept | Region | Department     | Crime_pers | Crime_prop | Literacy | Donations | Infants | Suicides | MainCity | Wealth | Commerce | Clergy | Crime_parents | Infanticide | Donation_clergy | Lottery | Desertion | Instruction | Prostitutes | Distance | Area | Pop1831 |
|-----------|-----------|-----------|-----------|-----------|------|--------|----------------|------------|------------|----------|-----------|---------|----------|----------|--------|----------|--------|---------------|-------------|-----------------|---------|-----------|-------------|-------------|----------|------|---------|
| f64       | f64       | f64       | f64       | f64       | i64  | str    | str            | i64        | i64        | i64      | i64       | i64     | i64      | str      | i64    | i64      | i64    | i64           | i64         | i64             | i64     | i64       | i64         | i64         | f64      | i64  | f64     |
| 42.992617 | 1.965112  | 21.877945 | 39.083383 | 46.901852 | 1    | "E"    | "Ain"          | 28870      | 15890      | 37       | 5098      | 33120   | 35039    | "2:Med"  | 73     | 58       | 11     | 71            | 60          | 69              | 41      | 55        | 46          | 13          | 218.372  | 5762 | 346.03  |
| 43.954782 | 4.570692  | 9.616657  | 34.862219 | 53.047345 | 2    | "N"    | "Aisne"        | 26226      | 5521       | 51       | 8901      | 14572   | 12831    | "2:Med"  | 22     | 10       | 82     | 4             | 82          | 36              | 38      | 82        | 24          | 327         | 65.945   | 7369 | 513.0   |
| 29.729568 | 2.744031  | 10.834267 | 24.270815 | 35.188321 | 3    | "C"    | "Allier"       | 26747      | 7925       | 13       | 10973     | 17044   | 114121   | "2:Med"  | 61     | 66       | 68     | 46            | 42          | 76              | 66      | 16        | 85          | 34          | 161.927  | 7340 | 298.26  |
| 32.891659 | 3.25552   | 10.103351 | 26.415393 | 39.367925 | 4    | "E"    | "Basses-Alpes" | 12935      | 7289       | 46       | 2733      | 23018   | 14238    | "1:Sm"   | 76     | 49       | 5      | 70            | 12          | 37              | 80      | 32        | 29          | 2           | 351.399  | 6925 | 155.9   |
| 34.085588 | 3.417628  | 9.973463  | 27.286836 | 40.884339 | 5    | "E"    | "Hautes-Alpes" | 17488      | 8174       | 69       | 6962      | 23076   | 16171    | "1:Sm"   | 83     | 65       | 10     | 22            | 23          | 64              | 79      | 35        | 7           | 1           | 320.28   | 5549 | 129.1   |


## Group averages (SEs are broken)

``` python
predictions(fit, by = "Region")
```

<small>shape: (6, 6)</small>

| Region | estimate  | std_error    | statistic | conf_low      | conf_high    |
|--------|-----------|--------------|-----------|---------------|--------------|
| str    | f64       | f64          | f64       | f64           | f64          |
| "N"    | 41.974184 | 4.9965e8     | 8.4008e-8 | -9.9395e8     | 9.9395e8     |
| "C"    | 35.693435 | 30845.923967 | 0.001157  | -61326.675517 | 61398.062388 |
| "S"    | 33.82303  | 8.5246e8     | 3.9677e-8 | -1.6958e9     | 1.6958e9     |
| "E"    | 43.892679 | 1.5626e9     | 2.8089e-8 | -3.1086e9     | 3.1086e9     |
| null   | 22.66595  | 1.7633e9     | 1.2854e-8 | -3.5079e9     | 3.5079e9     |
| "W"    | 41.871616 | 1.5203e8     | 2.7542e-7 | -3.0243e8     | 3.0243e8     |

